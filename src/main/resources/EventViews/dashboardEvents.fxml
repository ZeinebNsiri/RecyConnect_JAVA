<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.text.Text?>

<BorderPane prefHeight="800.0" prefWidth="1100.0" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="controllers.Events.DashboardEventsController">
    <top>
        <HBox alignment="CENTER_LEFT" spacing="10.0" style="-fx-background-color: #3498db;" BorderPane.alignment="CENTER">
            <children>
                <Label text="Tableau de Bord Analytics" textFill="WHITE">
                    <font>
                        <Font name="System Bold" size="24.0" />
                    </font>
                </Label>
                <HBox alignment="CENTER_RIGHT" spacing="10.0" HBox.hgrow="ALWAYS">
                    <Button onAction="#refreshDashboard" style="-fx-background-color: #2980b9; -fx-text-fill: white;" text="Actualiser">
                        <font>
                            <Font name="System Bold" size="12.0" />
                        </font>
                    </Button>
                </HBox>
            </children>
            <padding>
                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
            </padding>
        </HBox>
    </top>
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" BorderPane.alignment="CENTER">
            <tabs>
                <!-- Tab 1: Events -->
                <Tab text="Événements">
                    <content>
                        <ScrollPane fitToHeight="true" fitToWidth="true">
                            <content>
                                <VBox spacing="20.0">
                                    <padding>
                                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                                    </padding>
                                    <children>
                                        <GridPane fx:id="statsGrid" hgap="20.0" vgap="10.0">
                                            <columnConstraints>
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                            </columnConstraints>
                                            <rowConstraints>
                                                <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                                <RowConstraints minHeight="10.0" prefHeight="50.0" vgrow="SOMETIMES" />
                                            </rowConstraints>
                                            <children>
                                                <VBox alignment="CENTER" style="-fx-background-color: #3498db; -fx-background-radius: 5;">
                                                    <children>
                                                        <Label text="Total Événements" textFill="WHITE">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #2ecc71; -fx-background-radius: 5;" GridPane.columnIndex="1">
                                                    <children>
                                                        <Label text="Capacité Totale" textFill="WHITE">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #e74c3c; -fx-background-radius: 5;" GridPane.columnIndex="2">
                                                    <children>
                                                        <Label text="Réservations Totales" textFill="WHITE">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #f39c12; -fx-background-radius: 5;" GridPane.columnIndex="3">
                                                    <children>
                                                        <Label text="Utilisation Moyenne" textFill="WHITE">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #ecf0f1; -fx-background-radius: 5;" GridPane.rowIndex="1">
                                                    <children>
                                                        <Label fx:id="totalEventsLabel" text="0" textFill="#3498db">
                                                            <font>
                                                                <Font name="System Bold" size="24.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #ecf0f1; -fx-background-radius: 5;" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                                    <children>
                                                        <Label fx:id="totalCapacityLabel" text="0" textFill="#2ecc71">
                                                            <font>
                                                                <Font name="System Bold" size="24.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #ecf0f1; -fx-background-radius: 5;" GridPane.columnIndex="2" GridPane.rowIndex="1">
                                                    <children>
                                                        <Label fx:id="totalReservationsLabel" text="0" textFill="#e74c3c">
                                                            <font>
                                                                <Font name="System Bold" size="24.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                                <VBox alignment="CENTER" style="-fx-background-color: #ecf0f1; -fx-background-radius: 5;" GridPane.columnIndex="3" GridPane.rowIndex="1">
                                                    <children>
                                                        <Label fx:id="avgUtilizationLabel" text="0%" textFill="#f39c12">
                                                            <font>
                                                                <Font name="System Bold" size="24.0" />
                                                            </font>
                                                        </Label>
                                                    </children>
                                                    <padding>
                                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                    </padding>
                                                </VBox>
                                            </children>
                                        </GridPane>

                                        <HBox spacing="20.0">
                                            <children>
                                                <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                                                    <children>
                                                        <Label text="Utilisation de la Capacité des Événements" styleClass="section-header">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                        <PieChart fx:id="pieChartCapacity" title="Capacité des Événements" legendVisible="true" labelsVisible="true" prefHeight="300.0" />
                                                    </children>
                                                </VBox>
                                                <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                                                    <children>
                                                        <Label text="Événements les Plus Populaires" styleClass="section-header">
                                                            <font>
                                                                <Font name="System Bold" size="14.0" />
                                                            </font>
                                                        </Label>
                                                        <BarChart fx:id="barChartPopular" title="Événements Populaires" prefHeight="300.0">
                                                            <xAxis>
                                                                <CategoryAxis label="Événements" />
                                                            </xAxis>
                                                            <yAxis>
                                                                <NumberAxis label="Réservations" />
                                                            </yAxis>
                                                        </BarChart>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <!-- Tab 2: Workshops -->
                <Tab text="Workshops">
                    <content>
                        <ScrollPane fitToHeight="true" fitToWidth="true" style="-fx-background-color:transparent;">
                            <content>
                                <VBox spacing="30" style="-fx-background-color: #f8f9fa;">
                                    <padding>
                                        <Insets top="30" right="30" bottom="30" left="30"/>
                                    </padding>
                                    <Label text="Statistiques des Workshops" style="-fx-font-size: 24px; -fx-text-fill: #014421; -fx-font-weight: bold;"/>

                                    <!-- 1) BarChart - Nombre du workshop par catégorie -->
                                    <VBox spacing="10">
                                        <Label text="Nombre du workshop par catégorie" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                        <BarChart fx:id="barChartCategory" prefHeight="300" title="Workshops par Catégorie">
                                            <xAxis>
                                                <CategoryAxis label="Catégorie"/>
                                            </xAxis>
                                            <yAxis>
                                                <NumberAxis label="Nombre"/>
                                            </yAxis>
                                        </BarChart>
                                    </VBox>

                                    <!-- 2) PieChart - Total des notes par catégorie -->
                                    <VBox spacing="10">
                                        <Label text="Répartition du total des notes par catégorie" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                        <PieChart fx:id="pieChartRatingSum" prefHeight="300"/>
                                    </VBox>

                                    <!-- 3) PolarArea (converted to LineChart) - Moyenne des notes par Workshop -->
                                    <VBox spacing="10">
                                        <Label text="Moyenne de notes par Workshop" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                        <LineChart fx:id="polarChartAverage" title="Moyenne par Workshop" prefHeight="300">
                                            <xAxis>
                                                <CategoryAxis label="Workshop"/>
                                            </xAxis>
                                            <yAxis>
                                                <NumberAxis label="Moyenne"/>
                                            </yAxis>
                                        </LineChart>
                                    </VBox>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <!-- Tab 3: Articles -->
                <Tab text="Articles">
                    <content>
                        <ScrollPane fitToWidth="true" style="-fx-background-color: #f0fdf4;">
                            <content>
                                <VBox spacing="30" alignment="TOP_CENTER" style="-fx-background-color: #f0fdf4;">
                                    <padding>
                                        <Insets top="20" right="20" bottom="20" left="20"/>
                                    </padding>

                                    <!-- PieChart -->
                                    <Label text="Répartition des Articles par Catégorie" style="-fx-font-size: 24px; -fx-text-fill: #222; -fx-font-weight: bold;"/>
                                    <PieChart fx:id="pieChartArticle" prefWidth="1000" maxWidth="Infinity"/>

                                    <!-- BarChart: Quantité des articles par catégorie -->
                                    <VBox spacing="10" alignment="TOP_CENTER">
                                        <Label text="Quantité des Articles par Catégorie" style="-fx-font-size: 24px; -fx-text-fill: #222; -fx-font-weight: bold;"/>
                                        <BarChart fx:id="barChartCategorie" prefWidth="700" prefHeight="500">
                                            <xAxis>
                                                <CategoryAxis label="Catégories"/>
                                            </xAxis>
                                            <yAxis>
                                                <NumberAxis label="Quantité"/>
                                            </yAxis>
                                        </BarChart>
                                    </VBox>

                                    <!-- BarChart: Quantité de chaque article -->
                                    <VBox spacing="10" alignment="TOP_CENTER">
                                        <Label text="Quantité de chaque Article" style="-fx-font-size: 24px; -fx-text-fill: #222; -fx-font-weight: bold;"/>
                                        <BarChart fx:id="barChartArticle" prefWidth="700" prefHeight="500">
                                            <xAxis>
                                                <CategoryAxis label="Articles"/>
                                            </xAxis>
                                            <yAxis>
                                                <NumberAxis label="Quantité"/>
                                            </yAxis>
                                        </BarChart>
                                    </VBox>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <!-- Tab 4: Utilisateurs -->
                <Tab text="Utilisateurs">
                    <content>
                        <ScrollPane fitToWidth="true" style="-fx-background-color: #f0fdf4;">
                            <content>
                                <VBox spacing="20" alignment="CENTER" style="-fx-background-color: #f0fdf4;">
                                    <padding>
                                        <Insets top="20" left="20" right="20" bottom="20"/>
                                    </padding>

                                    <StackPane>
                                        <VBox style="-fx-background-color: white; -fx-padding: 20px; -fx-background-radius: 10; -fx-border-radius: 10; -fx-effect: dropshadow(gaussian, gray, 10, 0.5, 0, 0);"
                                              maxWidth="600">
                                            <Text text="Répartition des utilisateurs par rôle" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                            <PieChart fx:id="rolePieChart" prefWidth="600" prefHeight="300"/>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Total Utilisateurs: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="totalRoleCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Particuliers: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="particulierCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Professionnels: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="professionnelCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                        </VBox>
                                    </StackPane>

                                    <StackPane>
                                        <VBox style="-fx-background-color: white; -fx-padding: 20px; -fx-background-radius: 10; -fx-border-radius: 10; -fx-effect: dropshadow(gaussian, gray, 10, 0.5, 0, 0);"
                                              maxWidth="600">
                                            <Text text="Répartition des utilisateurs selon le statut" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                            <PieChart fx:id="statusPieChart" prefWidth="600" prefHeight="300"/>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Total Utilisateurs: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="totalStatusCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Actifs: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="actifCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Désactivés: " style="-fx-font-weight: bold;"/>
                                                <Label fx:id="desactiveCount" style="-fx-font-size: 16px;"/>
                                            </HBox>
                                        </VBox>
                                    </StackPane>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <!-- Tab 5: Commandes -->
                <Tab text="Commandes">
                    <content>
                        <AnchorPane prefWidth="800" prefHeight="500" style="-fx-background-color: #e9f5ef;">
                            <VBox spacing="20" AnchorPane.leftAnchor="20" AnchorPane.rightAnchor="20" AnchorPane.topAnchor="30">
                                <!-- Carte Statistiques -->
                                <VBox spacing="10"
                                      style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20;">
                                    <Label text="Statistiques Ventes" style="-fx-font-weight: bold; -fx-text-fill: #003366;" />
                                    <HBox spacing="50">
                                        <VBox>
                                            <Label text="Total des ventes - Aujourd'hui" />
                                            <Label fx:id="totalVentesLabel" text="0 TND" style="-fx-font-weight: bold;" />
                                        </VBox>
                                        <VBox>
                                            <Label text="Ventes Payées (Commandes payées)" />
                                            <Label fx:id="ventesPayeesLabel" text="0" style="-fx-font-weight: bold;" />
                                        </VBox>
                                    </HBox>
                                </VBox>

                                <!-- Graphiques côte à côte -->
                                <HBox spacing="20">
                                    <!-- Pie Chart à gauche -->
                                    <PieChart fx:id="pieChartVentes" prefHeight="250" prefWidth="350" />
                                    <!-- Bar Chart à droite -->
                                    <BarChart fx:id="barChartVisa" prefHeight="250" prefWidth="350">
                                        <xAxis>
                                            <CategoryAxis fx:id="xAxis" label="Méthodes de Paiement" />
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis fx:id="yAxis" label="Nombre de commandes" />
                                        </yAxis>
                                    </BarChart>
                                </HBox>
                            </VBox>
                        </AnchorPane>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
    <bottom>
        <HBox alignment="CENTER" spacing="10.0" style="-fx-background-color: #ecf0f1; -fx-padding: 10px;">
            <Label text="© 2025 - Tableau de bord unifié" />
        </HBox>
    </bottom>
</BorderPane>